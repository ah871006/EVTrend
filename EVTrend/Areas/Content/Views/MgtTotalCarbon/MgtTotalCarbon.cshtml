@using EVTrend.Areas.Content.Models
@using System.Data
@{
    ViewData["Title"] = "總體碳排量管理";
}
@{

    IEnumerable<MgtTotalCarbonModel> TotalCarbons = ViewData["GetTotalCarbon"] as IEnumerable<MgtTotalCarbonModel>;
    IEnumerable<TimeModel> TotalYears = ViewData["GetYear"] as IEnumerable<TimeModel>;
    IEnumerable<CountryModel> TotalCountry = ViewData["GetCountry"] as IEnumerable<CountryModel>;
}
<h1>@ViewData["Title"]</h1>

<table>
    <tr>
        <th>編號</th>
        <th>國家</th>
        <th>年分</th>
        <th>運輸業碳排量</th>
        <th>總體碳排量</th>
        <th>創建時間</th>
        <th>修改時間</th>
    </tr>
    @foreach (MgtTotalCarbonModel item in TotalCarbons)
    {
<tr>
    <td>@item.TotalCarbonNo</td>
    <td>@item.Year</td>
    <td>@item.Country</td>
    <td>@item.T_CarbonNumber</td>
    <td>@item.TotalCarbonNumber</td>
    <td>@item.CreateTime</td>
    <td>@item.ModifyTime</td>
    <td><button onclick="showEdit()">修改</button></td>
    <td><button onclick="deleteSubmit(@item.TotalCarbonNo)">刪除</button></td>
</tr>
    }
</table>
<div>
    <form>
        <label class="ye">年份</label>
        <select id="Year">
            @foreach (var item in TotalYears)
            {
                <option value="@item.YearNo">@item.YearName</option>
            }
        </select>
        <label class="ye">國家</label>
        <select id="Country">
            @foreach (var item in TotalCountry)
            {
                <option value="@item.CountryNo">@item.CountryName</option>
            }
        </select>
        <label class="ye">運輸業碳排量</label>
        <input id="CarbonNumber" />
        <label class="ye">總體碳排量</label>
        <input id="TotalNumber" />
        <button type="button" onclick="insertSubmit()">新增</button>

    </form>
</div>
<script>
    //新增功能
    function insertSubmit() {
        var YearNo = $("#Year").val();
        var CountryNo = $("#Country").val();
        var T_CarbonNumber = $("#CarbonNumber").val();
        var TotalCarbonNumber = $("#TotalNumber").val();

        //數字限制條件 驗證非負浮點數（正浮點數   0）
        var NumberReg = /^[+]{0,1}(\d+)$|^[+]{0,1}(\d+\.\d+)$/;

        //輸入檢查
        if (YearNo == "" || CountryNo == "") {
            alert("請選擇確切的年份和國家！");
            return
        } else if (!NumberReg.test(T_CarbonNumber) || !NumberReg.test(TotalCarbonNumber) || T_CarbonNumber == "" || CarbonNumber == "") {
            alert("請輸入正確碳排量！ (非負數字)");
            return
        }


        $.ajax({
            type: "POST",
            url: "MgtTotalCarbon/InsertTotalCarbon",
            data: {
                "YearNo": YearNo,
                "CountryNo": CountryNo,
                "T_CarbonNumber": T_CarbonNumber,
                "TotalCarbonNumber": TotalCarbonNumber
            },
            async: true,
            beforeSend: function () {

            },
            success: function (result) {
                //console.log(data);
                if (result == true) {
                    //searchSubmit();
                    alert("新增成功")
                    location.reload();
                    //$("#msg").text("新增成功");
                } else {
                    alert("新增失敗!! 可能失敗原因：資料已存在、權限不足")
                    location.reload();
                    //$("#msg").text("新增失敗!! 可能失敗原因：輸入錯誤(須為整數且不為負)、資料已存在、權限不足");
                }


            },
            error: function (e) {
                console.log(e);
            }
        });

    }

    //修改功能
    function showEdit() {

    }

    //刪除功能
    function deleteSubmit(id) {
        //視窗提示
        if (window.confirm("是否確定要刪除?")) {
            $.ajax({
                type: "POST",
                url: "MgtTotalCarbon/DeleteTotalCarbon",
                data: {
                    "TotalCarbonNo": id,
                },
                async: true,
                beforeSend: function () {

                },
                success: function (result) {
                    //console.log(data);
                    if (result == true) {
                        alert("刪除成功");
                        location.reload();
                        //$("#msg").text("新增成功");
                    } else {
                        alert("刪除失敗!! 可能失敗原因：權限不足");
                        location.reload();
                        //$("#msg").text("新增失敗!! 可能失敗原因：輸入錯誤(須為整數且不為負)、資料已存在、權限不足");
                    }


                },
                error: function (e) {
                    console.log(e);
                }
            });
        }
    }
</script>