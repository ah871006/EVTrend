@using EVTrend.Areas.Content.Models
@using System.Data
@{
    ViewData["Title"] = "電動車數據管理";
}
@{

    IEnumerable<MgtTotalElecModel> TotalElecs = ViewData["GetTotalElec"] as IEnumerable<MgtTotalElecModel>;
    IEnumerable<TimeModel> TotalYears = ViewData["GetYear"] as IEnumerable<TimeModel>;
    IEnumerable<CountryModel> TotalCountry = ViewData["GetCountry"] as IEnumerable<CountryModel>;
}
<h1>@ViewData["Title"]</h1>

<table>
    <tr>
        <th>編號</th>
        <th>國家</th>
        <th>年分</th>
        <th>電動車領牌數</th>
        <th>全部車種領牌數</th>
        <th>創建時間</th>
        <th>修改時間</th>
    </tr>
    @foreach (MgtTotalElecModel item in TotalElecs)
    {
        <tr>
            <td>@item.TotalRegisterNo</td>
            <td>@item.Year</td>
            <td>@item.Country</td>
            <td>@item.ElecRegisterNumber</td>
            <td>@item.TotalRegisterNumber</td>
            <td>@item.CreateTime</td>
            <td>@item.ModifyTime</td>
            <td><button onclick="showEdit()">修改</button></td>
            <td><button onclick="deleteSubmit(@item.TotalRegisterNo)">刪除</button></td>
        </tr>
    }
</table>
<div>
    <form>
        <label class="ye">年份</label>
        <select id="Year">
            @foreach (var item in TotalYears)
            {
                <option value="@item.YearNo">@item.YearName</option>
            }
        </select>
        <label class="ye">國家</label>
        <select id="Country">
            @foreach (var item in TotalCountry)
            {
                <option value="@item.CountryNo">@item.CountryName</option>
            }
        </select>
        <label class="ye">電動車領牌數</label>
        <input id="ElecNumber" />
        <label class="ye">全部車種領牌數</label>
        <input id="TotalNumber" />
        <button type="button" onclick="insertSubmit()">新增</button>

    </form>
</div>
<script>
    //新增功能
    function insertSubmit() {
        var YearNo = $("#Year").val();
        var CountryNo = $("#Country").val();
        var ElecRegisterNumber = $("#ElecNumber").val();
        var TotalRegisterNumber = $("#TotalNumber").val();

        //數字限制條件 驗證非負浮點數（正浮點數   0）
        var NumberReg = /^[+]{0,1}(\d+)$|^[+]{0,1}(\d+\.\d+)$/;

        //輸入檢查
        if (YearNo == "" || CountryNo == "") {
            alert("請選擇確切的年份和國家！");
            return
        } else if (!NumberReg.test(ElecRegisterNumber) || !NumberReg.test(TotalRegisterNumber) || ElecRegisterNumber == "" || TotalRegisterNumber == "") {
            alert("請輸入正確車子領牌數量！ (非負數字)");
            return
        }


        $.ajax({
            type: "POST",
            url: "MgtTotalElec/InsertTotalElec",
            data: {
                "YearNo": YearNo,
                "CountryNo": CountryNo,
                "ElecRegisterNumber": ElecRegisterNumber,
                "TotalRegisterNumber": TotalRegisterNumber
            },
            async: true,
            beforeSend: function () {

            },
            success: function (result) {
                //console.log(data);
                if (result == true) {
                    //searchSubmit();
                    alert("新增成功")
                    location.reload();
                    //$("#msg").text("新增成功");
                } else {
                    alert("新增失敗!! 可能失敗原因：資料已存在、權限不足")
                    location.reload();
                    //$("#msg").text("新增失敗!! 可能失敗原因：輸入錯誤(須為整數且不為負)、資料已存在、權限不足");
                }


            },
            error: function (e) {
                console.log(e);
            }
        });

    }

    //修改功能
    function showEdit() {

    }

    //刪除功能
    function deleteSubmit(id) {
        //視窗提示
        if (window.confirm("是否確定要刪除?")) {
            $.ajax({
                type: "POST",
                url: "MgtTotalElec/DeleteTotalElec",
                data: {
                    "TotalRegisterNo": id,
                },
                async: true,
                beforeSend: function () {

                },
                success: function (result) {
                    //console.log(data);
                    if (result == true) {
                        alert("刪除成功");
                        location.reload();
                        //$("#msg").text("新增成功");
                    } else {
                        alert("刪除失敗!! 可能失敗原因：權限不足");
                        location.reload();
                        //$("#msg").text("新增失敗!! 可能失敗原因：輸入錯誤(須為整數且不為負)、資料已存在、權限不足");
                    }


                },
                error: function (e) {
                    console.log(e);
                }
            });
        }
    }
</script>